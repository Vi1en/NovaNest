customElements.get("dbtfy-gift-wrap")||customElements.define("dbtfy-gift-wrap",class extends HTMLElement{constructor(){super(),this.enableWidget=!0,this.data=Debutify.widgets["dbtfy-gift-wrap"],this.priceBox=this.querySelector(".price"),this.checkbox=this.querySelector(".dbtfy-gift-wrap__checkbox"),this.messageBox=this.querySelector(".dbtfy-gift-wrap__message"),this.messageInput=this.messageBox.querySelector(".text-area"),this.setupProductData(),this.enableWidget&&this.checkInCart(),this.enableWidget&&this.messageInput.addEventListener("input",this.updateMessage.bind(this)),localStorage.getItem("dbtfy_gift_wrap")==="true"&&(this.checkbox.checked=!0,this.messageBox.classList.remove("hidden"),this.querySelector("details").setAttribute("open",!0),setTimeout(()=>{localStorage.removeItem("dbtfy_gift_wrap")},1e3))}async updateMessage(){const cartUpdateData={attributes:{gift_message:this.messageInput.value}};this.abortController&&this.abortController.abort(),this.abortController=new AbortController;try{const response=await fetch(`${window.routes.cart_update_url}.js`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(cartUpdateData),signal:this.abortController.signal})}catch(error){console.error("Error updating cart:",error)}}setupProductData(){if(!this.data.dbtfy_gift_wrap_product)return this.removeWidget(),!1;this.gift_product=this.data.dbtfy_gift_wrap_product}checkInCart(){var dbtfy_gift_wrap=this;fetch(`/products/${this.gift_product}.js`).then(response=>response.json()).then(data=>{dbtfy_gift_wrap.gift_product=data.variants[0],dbtfy_gift_wrap.data.dbtfy_gift_wrap_show_price&&dbtfy_gift_wrap.gift_product.price>0&&(dbtfy_gift_wrap.priceBox.innerHTML=`(${Debutify.currency.symbol}${dbtfy_gift_wrap.gift_product.price/100})`),Debutify.cart.items.forEach(item=>{item.variant_id==dbtfy_gift_wrap.gift_product.id&&(dbtfy_gift_wrap.checkbox.checked=!0,dbtfy_gift_wrap.messageBox.classList.remove("hidden"),Debutify.cart.attributes.gift_message&&(dbtfy_gift_wrap.messageInput.value=Debutify.cart.attributes.gift_message))})}).catch(error=>{console.log("Error:",error),dbtfy_gift_wrap.removeWidget()})}removeWidget(){this.enableWidget=!1,this.remove()}connectedCallback(){this.checkbox.addEventListener("change",this.changeCheckbox.bind(this))}changeCheckbox(){this.checkbox.checked?this.submitGiftProduct():this.removeGiftProduct()}submitGiftProduct(){const variantId=Number(this.gift_product.id);Debutify.ajaxAddToCart({id:variantId,quantity:1}),this.messageBox.classList.remove("hidden"),localStorage.setItem("dbtfy_gift_wrap",!0)}removeGiftProduct(){let shouldBreak=!1;document.querySelectorAll("cart-remove-button").forEach(removeButton=>{shouldBreak||removeButton.querySelector("button").dataset.variantId==this.gift_product.id&&(shouldBreak=!0,this.messageBox.classList.add("hidden"),removeButton.click())})}});
//# sourceMappingURL=/s/files/1/0643/2004/5130/t/2/assets/dbtfy-gift-wrap.js.map?v=34884345805890486351744962460
