customElements.get("dbtfy-cart-discount")||customElements.define("dbtfy-cart-discount",class extends HTMLElement{constructor(){super(),this.data=Debutify.widgets["dbtfy-cart-discount"],this.querySelector(".delivery-label-icon i").setAttribute("data-icon",this.data.dbtfy_cart_discount_label_icon),this.discountSummaryLabel=this.querySelector(".dbtfy-cart-discount-show"),this.discountStatus=this.querySelector(".discount-status"),this.discountCode="",this.button=this.querySelector(".dbtfy-cart-discount__button"),this.modalHeader=this.querySelector(".dbtfy-discount-modal--header"),this.relaceText=this.dataset.relaceText,this.fetch=!1,this.setup()}setup(){typeof Debutify.modal<"u"?this.loadModel():document.addEventListener("DOMContentLoaded",()=>{this.loadModel()}),this.init(),this.fetchCart("")}init(){this.button&&(this.button.onclick=()=>{const inputValue=this.querySelector("input").value;inputValue!==""&&(this.discountCode=inputValue,this.checkExistingDiscountAndApply(inputValue),this.fetch=!0)})}loadModel(){this.modalHeader.textContent=this.relaceText,this.modal=new Debutify.modal({closeMethods:[],size:"medium",closeIcon:"",selector:"dbtfy-discount-modal",boxClass:["dbtfy-discount-box"],overlayClass:[],onOpen:function(){console.log("modal open")},onClose:function(){console.log("modal closed")}})}drawerUpdate(){this.dataset.type==="cartPage"?(localStorage.setItem("dbtfy-cart-discount",this.discountCode),window.location.reload()):this.dataset.type==="cartDrawer"&&fetch(`${routes.cart_url}?section_id=cart-drawer`).then(response=>response.text()).then(responseText=>{const thisDrawer=new DOMParser().parseFromString(responseText,"text/html").querySelector("#shopify-section-cart-drawer #CartDrawer");document.querySelector("#shopify-section-cart-drawer #CartDrawer").replaceWith(thisDrawer)}).catch(e=>{console.error(e)})}applyDiscount(discountCode){fetch(`/discount/${discountCode}`,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(response=>{response.ok||console.error("Failed to apply discount: "+response.statusText)}).catch(error=>{console.error("Error applying discount:",error)}).finally(()=>{localStorage.setItem("dbtfy-cart-discount",discountCode),this.drawerUpdate()})}checkExistingDiscountAndApply(discountCode){const existingDiscount=document.querySelector(".discounts__discount");existingDiscount&&existingDiscount.textContent.trim()===""?this.applyDiscount(discountCode):this.fetchCart(discountCode)}fetchCart(discountCode){fetch(`${window.routes.cart_url}.js`).then(response=>response.json()).then(cart=>{let discountApplied=!1;this.cartItemsDiscount=cart.items,this.cartItemsDiscount.forEach(item=>{let discountCode2="";item.discounts.length>0&&(discountApplied=!0,discountCode2=item.discounts[0].title,document.querySelectorAll('.dbtfy-cart-discount__container input[type="text"]').forEach(input=>{input.value=discountCode2}),this.discountSummaryLabel.textContent=discountCode2)}),discountApplied?this.fetch&&(console.log(this),this.modal.modal.querySelectorAll(".dbtfy-discount-modal-check-yes-no button").forEach(button=>{button.onclick=()=>{button.value==="yes"?(this.modal.close(),console.log("yes",this),this.applyDiscount(discountCode)):this.modal.close()}}),this.modal.open()):this.fetch&&this.applyDiscount(discountCode),localStorage.getItem("dbtfy-cart-discount")&&(this.discountStatus.classList.remove("hidden"),localStorage.getItem("dbtfy-cart-discount")==this.discountSummaryLabel.textContent?this.discountStatus.textContent=" Applied":this.discountStatus.textContent=" Invalid",localStorage.removeItem("dbtfy-cart-discount"))}).catch(error=>{console.error("Error fetching cart:",error)})}});
//# sourceMappingURL=/s/files/1/0643/2004/5130/t/2/assets/dbtfy-cart-discount.js.map?v=144505767793374093911744962460
