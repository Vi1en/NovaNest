customElements.get("dbtfy-variant-picker")||customElements.define("dbtfy-variant-picker",class extends HTMLElement{constructor(){super(),this.id=this.dataset.id,this.url=this.dataset.url,this.pickerWrapper=this.querySelector(".dbtfy-variant-picker__picker"),this.select=this.querySelector(".dbtfy-variant-picker__selector"),this.optionUnavailable=this.dataset.optionUnavailable,this.picker=void 0,this.testMode=Shopify.designMode,this.selectEvent=null}disconnectedCallback(){this.testMode&&this.selectEvent()}connectedCallback(){this.testMode&&(this.selectEvent=subscribe(PUB_SUB_EVENTS.shopifyEventBlockSelect,e=>{e.detail.blockId.includes("product_variant_picker")&&this.init()})),this.init()}init(){this.select&&(this.pickerWrapper.innerHTML.trim()===""?this.fetchVariantPicker():this.addEventChangePicker())}async fetchVariantPicker(){try{let data=await Debutify.fetchProductMarkup(this.url);if(data){const pickerElement=new DOMParser().parseFromString(data,"text/html").querySelector("variant-selects"),sectionId=pickerElement.dataset.section;pickerElement.innerHTML=pickerElement.innerHTML.replaceAll(sectionId,this.id).replaceAll("disabled","").replaceAll(this.optionUnavailable,""),pickerElement.querySelectorAll("fieldset").forEach((fieldset,index)=>{fieldset.querySelectorAll("input, select").forEach(ele=>{ele.setAttribute("name",`${this.id}-${index+1}`)})}),this.pickerWrapper.innerHTML="",this.pickerWrapper.appendChild(pickerElement),this.addEventChangePicker()}else return console.error("HTTP-Error: "+res.status),null}catch(error){return console.error("Error: "+error),null}}addEventChangePicker(){this.picker=this.pickerWrapper.querySelector("variant-selects"),this.picker?.querySelectorAll("label").forEach(label=>{label.addEventListener("click",e=>{e.preventDefault();const input=e.target.closest("label").previousElementSibling;input.disabled||(input.checked=!0,this.changePicker())})}),this.picker?.querySelectorAll(".select__select").forEach(select=>{select.addEventListener("change",e=>{e.preventDefault(),this.changePicker()})})}changePicker(){const variantTitle=Array.from(this.picker.querySelectorAll("input:checked, .select__select")).map(option=>option.value).join(" / ");this.select.value=this.select.querySelector(`option[data-title="${variantTitle}"]`).value,this.select.dispatchEvent(new Event("change"))}});
//# sourceMappingURL=/s/files/1/0643/2004/5130/t/2/assets/dbtfy-variant-picker.js.map?v=114381244389039939911744962461
